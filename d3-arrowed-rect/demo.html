<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>D3 Arrowed Rect Demo</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .demo-section {
        margin-bottom: 40px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .demo-section h2 {
        color: #555;
        margin-bottom: 15px;
      }
      .demo-section p {
        color: #666;
        margin-bottom: 15px;
      }
      svg {
        border: 1px solid #ccc;
        background-color: white;
      }
      .code-block {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 15px;
        margin: 10px 0;
        font-family: "Courier New", monospace;
        font-size: 12px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>D3 Arrowed Rect 演示</h1>

      <div class="demo-section">
        <h2>1. 基本用法</h2>
        <p>创建基本的向右和向左箭头矩形</p>
        <div id="basic-demo"></div>
        <div class="code-block">
          // 向右箭头 d3ArrowedRect(svg, { x: 50, y: 50, width: 150, height: 30,
          text: "Gene A", style: { fill: "#4CAF50", stroke: "#2E7D32" } }); //
          向左箭头 d3ArrowedRect(svg, { x: 50, y: 100, width: 150, height: 30,
          direction: "left", text: "Gene B", style: { fill: "#2196F3", stroke:
          "#1976D2" } });
        </div>
      </div>

      <div class="demo-section">
        <h2>2. 自定义样式</h2>
        <p>自定义箭头和文本样式</p>
        <div id="custom-style-demo"></div>
        <div class="code-block">
          d3ArrowedRect(svg, { x: 50, y: 50, width: 200, height: 40, text:
          "Custom Style", arrowStyle: { widthRatio: 0.4, neckRatio: 0.8 },
          textStyle: { fontSize: 14, fill: "#fff", fontFamily: "Georgia" },
          style: { fill: "#FF5722", stroke: "#D84315", strokeWidth: 2,
          fillOpacity: 0.9 } });
        </div>
      </div>

      <div class="demo-section">
        <h2>3. 交互事件</h2>
        <p>添加点击和悬停事件</p>
        <div id="interactive-demo"></div>
        <div class="code-block">
          d3ArrowedRect(svg, { x: 50, y: 50, width: 180, height: 35, text:
          "Click me!", style: { fill: "#9C27B0", stroke: "#7B1FA2" }, onClick:
          (event) => { alert("Arrow clicked!"); }, onMouseOver: (event) => {
          d3.select(event.target).style("opacity", 0.7); }, onMouseOut: (event)
          => { d3.select(event.target).style("opacity", 1); } });
        </div>
      </div>

      <div class="demo-section">
        <h2>4. 工厂函数</h2>
        <p>使用工厂函数创建统一风格的箭头</p>
        <div id="factory-demo"></div>
        <div class="code-block">
          // 创建基因箭头工厂 const geneArrow = d3ArrowedRectFactory({ height:
          25, style: { fill: "#4CAF50", stroke: "#2E7D32" }, textStyle: {
          fontSize: 10, fill: "#fff" } }); // 使用工厂函数 geneArrow(svg, { x:
          50, y: 50, width: 120, text: "Gene A" }); geneArrow(svg, { x: 50, y:
          85, width: 100, text: "Gene B" }); geneArrow(svg, { x: 50, y: 120,
          width: 140, text: "Gene C" });
        </div>
      </div>

      <div class="demo-section">
        <h2>5. 批量创建</h2>
        <p>批量创建多个箭头矩形</p>
        <div id="batch-demo"></div>
        <div class="code-block">
          const genes = [ { name: "Gene A", x: 50, y: 50, width: 120, direction:
          "right" }, { name: "Gene B", x: 50, y: 85, width: 100, direction:
          "left" }, { name: "Gene C", x: 50, y: 120, width: 140, direction:
          "right" } ]; d3ArrowedRectBatch(svg, genes, (d, i) => ({ x: d.x, y:
          d.y, width: d.width, height: 25, direction: d.direction, text: d.name,
          style: { fill: i % 2 === 0 ? "#4CAF50" : "#2196F3" } }));
        </div>
      </div>

      <div class="demo-section">
        <h2>6. 复杂示例</h2>
        <p>模拟基因序列可视化</p>
        <div id="complex-demo"></div>
        <div class="code-block">
          // 模拟基因数据 const geneSequence = [ { name: "Promoter", x: 50, y:
          50, width: 80, direction: "right", type: "promoter" }, { name: "CDS",
          x: 150, y: 50, width: 200, direction: "right", type: "cds" }, { name:
          "Terminator", x: 370, y: 50, width: 60, direction: "right", type:
          "terminator" } ]; geneSequence.forEach((gene, i) => { const colors = {
          promoter: { fill: "#FF9800", stroke: "#F57C00" }, cds: { fill:
          "#4CAF50", stroke: "#2E7D32" }, terminator: { fill: "#F44336", stroke:
          "#D32F2F" } }; d3ArrowedRect(svg, { x: gene.x, y: gene.y, width:
          gene.width, height: 30, direction: gene.direction, text: gene.name,
          style: colors[gene.type], textStyle: { fontSize: 11, fill: "#fff" }
          }); });
        </div>
      </div>
    </div>

    <script src="d3-arrowed-rect.js"></script>
    <script>
      // 1. 基本用法演示
      const basicSvg = d3
        .select("#basic-demo")
        .append("svg")
        .attr("width", 300)
        .attr("height", 150);

      d3ArrowedRect(basicSvg, {
        x: 50,
        y: 50,
        width: 150,
        height: 30,
        text: "Gene A",
        style: { fill: "#4CAF50", stroke: "#2E7D32" },
      });

      d3ArrowedRect(basicSvg, {
        x: 50,
        y: 100,
        width: 150,
        height: 30,
        direction: "left",
        text: "Gene B",
        style: { fill: "#2196F3", stroke: "#1976D2" },
      });

      // 2. 自定义样式演示
      const customSvg = d3
        .select("#custom-style-demo")
        .append("svg")
        .attr("width", 300)
        .attr("height", 100);

      d3ArrowedRect(customSvg, {
        x: 50,
        y: 30,
        width: 200,
        height: 40,
        text: "Custom Style",
        arrowStyle: {
          widthRatio: 0.4,
          neckRatio: 0.8,
        },
        textStyle: {
          fontSize: 14,
          fill: "#fff",
          fontFamily: "Georgia",
        },
        style: {
          fill: "#FF5722",
          stroke: "#D84315",
          strokeWidth: 2,
          fillOpacity: 0.9,
        },
      });

      // 3. 交互事件演示
      const interactiveSvg = d3
        .select("#interactive-demo")
        .append("svg")
        .attr("width", 300)
        .attr("height", 100);

      d3ArrowedRect(interactiveSvg, {
        x: 50,
        y: 30,
        width: 180,
        height: 35,
        text: "Click me!",
        style: { fill: "#9C27B0", stroke: "#7B1FA2" },
        onClick: (event) => {
          alert("Arrow clicked!");
        },
        onMouseOver: (event) => {
          d3.select(event.target).style("opacity", 0.7);
        },
        onMouseOut: (event) => {
          d3.select(event.target).style("opacity", 1);
        },
      });

      // 4. 工厂函数演示
      const factorySvg = d3
        .select("#factory-demo")
        .append("svg")
        .attr("width", 300)
        .attr("height", 150);

      const geneArrow = d3ArrowedRectFactory({
        height: 25,
        style: { fill: "#4CAF50", stroke: "#2E7D32" },
        textStyle: { fontSize: 10, fill: "#fff" },
      });

      geneArrow(factorySvg, { x: 50, y: 50, width: 120, text: "Gene A" });
      geneArrow(factorySvg, { x: 50, y: 85, width: 100, text: "Gene B" });
      geneArrow(factorySvg, { x: 50, y: 120, width: 140, text: "Gene C" });

      // 5. 批量创建演示
      const batchSvg = d3
        .select("#batch-demo")
        .append("svg")
        .attr("width", 300)
        .attr("height", 150);

      const genes = [
        { name: "Gene A", x: 50, y: 50, width: 120, direction: "right" },
        { name: "Gene B", x: 50, y: 85, width: 100, direction: "left" },
        { name: "Gene C", x: 50, y: 120, width: 140, direction: "right" },
      ];

      d3ArrowedRectBatch(batchSvg, genes, (d, i) => ({
        x: d.x,
        y: d.y,
        width: d.width,
        height: 25,
        direction: d.direction,
        text: d.name,
        style: {
          fill: i % 2 === 0 ? "#4CAF50" : "#2196F3",
        },
      }));

      // 6. 复杂示例演示
      const complexSvg = d3
        .select("#complex-demo")
        .append("svg")
        .attr("width", 500)
        .attr("height", 100);

      const geneSequence = [
        {
          name: "Promoter",
          x: 50,
          y: 35,
          width: 80,
          direction: "right",
          type: "promoter",
        },
        {
          name: "CDS",
          x: 150,
          y: 35,
          width: 200,
          direction: "right",
          type: "cds",
        },
        {
          name: "Terminator",
          x: 370,
          y: 35,
          width: 60,
          direction: "right",
          type: "terminator",
        },
      ];

      geneSequence.forEach((gene, i) => {
        const colors = {
          promoter: { fill: "#FF9800", stroke: "#F57C00" },
          cds: { fill: "#4CAF50", stroke: "#2E7D32" },
          terminator: { fill: "#F44336", stroke: "#D32F2F" },
        };

        d3ArrowedRect(complexSvg, {
          x: gene.x,
          y: gene.y,
          width: gene.width,
          height: 30,
          direction: gene.direction,
          text: gene.name,
          style: colors[gene.type],
          textStyle: { fontSize: 11, fill: "#fff" },
        });
      });
    </script>
  </body>
</html>
