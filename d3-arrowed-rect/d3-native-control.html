<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>D3 Arrowed Rect - 原生D3控制演示</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .demo-section {
        margin-bottom: 40px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .demo-section h2 {
        color: #555;
        margin-bottom: 15px;
      }
      .demo-section p {
        color: #666;
        margin-bottom: 15px;
      }
      svg {
        border: 1px solid #ccc;
        background-color: white;
        margin: 10px 0;
      }
      .code-block {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 15px;
        margin: 10px 0;
        font-family: "Courier New", monospace;
        font-size: 12px;
        overflow-x: auto;
      }
      .controls {
        margin: 15px 0;
        padding: 15px;
        background-color: #e8f5e8;
        border-radius: 5px;
      }
      .control-group {
        margin: 10px 0;
      }
      label {
        display: inline-block;
        width: 120px;
        font-weight: bold;
      }
      input,
      select {
        margin: 0 10px;
        padding: 5px;
      }
      button {
        margin: 5px;
        padding: 8px 15px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #45a049;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>D3 Arrowed Rect - 原生D3控制演示</h1>

      <div class="demo-section">
        <h2>1. 基本属性控制</h2>
        <p>使用D3的.attr()方法直接控制箭头矩形的属性</p>
        <div id="basic-control"></div>
        <div class="controls">
          <div class="control-group">
            <label>填充颜色:</label>
            <input type="color" id="fillColor" value="#4CAF50" />
            <button onclick="changeFillColor()">应用</button>
          </div>
          <div class="control-group">
            <label>描边颜色:</label>
            <input type="color" id="strokeColor" value="#2E7D32" />
            <button onclick="changeStrokeColor()">应用</button>
          </div>
          <div class="control-group">
            <label>描边宽度:</label>
            <input type="range" id="strokeWidth" min="1" max="10" value="1" />
            <span id="strokeWidthValue">1</span>
            <button onclick="changeStrokeWidth()">应用</button>
          </div>
        </div>
        <div class="code-block">
          // 获取箭头矩形元素 const arrowElement = d3.select("#basic-control svg
          .arrowed-rect polygon"); // 改变填充颜色 arrowElement.attr("fill",
          "#FF5722"); // 改变描边颜色 arrowElement.attr("stroke", "#D84315"); //
          改变描边宽度 arrowElement.attr("stroke-width", 3); // 改变透明度
          arrowElement.attr("fill-opacity", 0.7);
        </div>
      </div>

      <div class="demo-section">
        <h2>2. 变换和动画</h2>
        <p>使用D3的transform和transition方法</p>
        <div id="transform-demo"></div>
        <div class="controls">
          <button onclick="moveArrow()">移动箭头</button>
          <button onclick="scaleArrow()">缩放箭头</button>
          <button onclick="rotateArrow()">旋转箭头</button>
          <button onclick="resetTransform()">重置变换</button>
        </div>
        <div class="code-block">
          // 移动箭头 arrowElement.transition() .duration(1000)
          .attr("transform", "translate(50, 20)"); // 缩放箭头
          arrowElement.transition() .duration(1000) .attr("transform",
          "scale(1.5)"); // 旋转箭头 arrowElement.transition() .duration(1000)
          .attr("transform", "rotate(45)");
        </div>
      </div>

      <div class="demo-section">
        <h2>3. 样式和CSS控制</h2>
        <p>使用D3的.style()方法控制CSS样式</p>
        <div id="style-demo"></div>
        <div class="controls">
          <div class="control-group">
            <label>鼠标样式:</label>
            <select id="cursorStyle">
              <option value="pointer">pointer</option>
              <option value="crosshair">crosshair</option>
              <option value="grab">grab</option>
              <option value="zoom-in">zoom-in</option>
            </select>
            <button onclick="changeCursor()">应用</button>
          </div>
          <div class="control-group">
            <label>滤镜效果:</label>
            <select id="filterEffect">
              <option value="none">无</option>
              <option value="blur(2px)">模糊</option>
              <option value="brightness(1.5)">亮度</option>
              <option value="contrast(2)">对比度</option>
              <option value="drop-shadow(5px 5px 5px rgba(0,0,0,0.5))">
                阴影
              </option>
            </select>
            <button onclick="changeFilter()">应用</button>
          </div>
        </div>
        <div class="code-block">
          // 改变鼠标样式 arrowElement.style("cursor", "grab"); // 添加滤镜效果
          arrowElement.style("filter", "drop-shadow(5px 5px 5px
          rgba(0,0,0,0.5))"); // 改变混合模式
          arrowElement.style("mix-blend-mode", "multiply"); // 添加动画
          arrowElement.style("transition", "all 0.3s ease");
        </div>
      </div>

      <div class="demo-section">
        <h2>4. 事件处理</h2>
        <p>使用D3的.on()方法添加交互事件</p>
        <div id="event-demo"></div>
        <div class="controls">
          <button onclick="addClickEvent()">添加点击事件</button>
          <button onclick="addHoverEvent()">添加悬停事件</button>
          <button onclick="removeEvents()">移除所有事件</button>
        </div>
        <div class="code-block">
          // 添加点击事件 arrowElement.on("click", function(event) {
          d3.select(this).attr("fill",
          d3.rgb(d3.select(this).attr("fill")).brighter()); }); // 添加悬停事件
          arrowElement.on("mouseover", function(event) {
          d3.select(this).transition().duration(200).attr("stroke-width", 3); })
          .on("mouseout", function(event) {
          d3.select(this).transition().duration(200).attr("stroke-width", 1);
          }); // 添加拖拽事件 arrowElement.call(d3.drag() .on("drag",
          function(event) { d3.select(this).attr("transform",
          `translate(${event.x}, ${event.y})`); }));
        </div>
      </div>

      <div class="demo-section">
        <h2>5. 批量操作</h2>
        <p>对多个箭头矩形进行批量操作</p>
        <div id="batch-demo"></div>
        <div class="controls">
          <button onclick="batchChangeColor()">批量改变颜色</button>
          <button onclick="batchAnimate()">批量动画</button>
          <button onclick="batchFilter()">批量添加滤镜</button>
        </div>
        <div class="code-block">
          // 选择所有箭头矩形 const allArrows = d3.selectAll("#batch-demo
          .arrowed-rect polygon"); // 批量改变颜色 allArrows.attr("fill",
          function(d, i) { return d3.schemeCategory10[i % 10]; }); // 批量动画
          allArrows.transition() .duration(1000) .delay(function(d, i) { return
          i * 100; }) .attr("transform", "scale(1.2)"); // 批量添加滤镜
          allArrows.style("filter", "drop-shadow(3px 3px 3px rgba(0,0,0,0.3))");
        </div>
      </div>
    </div>

    <script src="d3-arrowed-rect.js"></script>
    <script>
      // 1. 基本属性控制演示
      const basicSvg = d3
        .select("#basic-control")
        .append("svg")
        .attr("width", 400)
        .attr("height", 100);

      const basicArrow = d3ArrowedRect(basicSvg, {
        x: 100,
        y: 35,
        width: 200,
        height: 30,
        text: "可控制的箭头",
        style: { fill: "#4CAF50", stroke: "#2E7D32" },
      });

      // 2. 变换演示
      const transformSvg = d3
        .select("#transform-demo")
        .append("svg")
        .attr("width", 400)
        .attr("height", 100);

      const transformArrow = d3ArrowedRect(transformSvg, {
        x: 100,
        y: 35,
        width: 150,
        height: 30,
        text: "变换箭头",
        style: { fill: "#2196F3", stroke: "#1976D2" },
      });

      // 3. 样式演示
      const styleSvg = d3
        .select("#style-demo")
        .append("svg")
        .attr("width", 400)
        .attr("height", 100);

      const styleArrow = d3ArrowedRect(styleSvg, {
        x: 100,
        y: 35,
        width: 180,
        height: 30,
        text: "样式箭头",
        style: { fill: "#FF5722", stroke: "#D84315" },
      });

      // 4. 事件演示
      const eventSvg = d3
        .select("#event-demo")
        .append("svg")
        .attr("width", 400)
        .attr("height", 100);

      const eventArrow = d3ArrowedRect(eventSvg, {
        x: 100,
        y: 35,
        width: 160,
        height: 30,
        text: "事件箭头",
        style: { fill: "#9C27B0", stroke: "#7B1FA2" },
      });

      // 5. 批量操作演示
      const batchSvg = d3
        .select("#batch-demo")
        .append("svg")
        .attr("width", 400)
        .attr("height", 100);

      const batchArrows = [];
      for (let i = 0; i < 3; i++) {
        batchArrows.push(
          d3ArrowedRect(batchSvg, {
            x: 50 + i * 120,
            y: 35,
            width: 100,
            height: 25,
            text: `箭头${i + 1}`,
            style: { fill: "#4CAF50", stroke: "#2E7D32" },
          })
        );
      }

      // 控制函数
      function changeFillColor() {
        const color = document.getElementById("fillColor").value;
        d3.select("#basic-control .arrowed-rect polygon").attr("fill", color);
      }

      function changeStrokeColor() {
        const color = document.getElementById("strokeColor").value;
        d3.select("#basic-control .arrowed-rect polygon").attr("stroke", color);
      }

      function changeStrokeWidth() {
        const width = document.getElementById("strokeWidth").value;
        document.getElementById("strokeWidthValue").textContent = width;
        d3.select("#basic-control .arrowed-rect polygon").attr(
          "stroke-width",
          width
        );
      }

      function moveArrow() {
        d3.select("#transform-demo .arrowed-rect polygon")
          .transition()
          .duration(1000)
          .attr("transform", "translate(50, 20)")
          .transition()
          .duration(1000)
          .attr("transform", "translate(0, 0)");
      }

      function scaleArrow() {
        d3.select("#transform-demo .arrowed-rect polygon")
          .transition()
          .duration(1000)
          .attr("transform", "scale(1.5)")
          .transition()
          .duration(1000)
          .attr("transform", "scale(1)");
      }

      function rotateArrow() {
        d3.select("#transform-demo .arrowed-rect polygon")
          .transition()
          .duration(1000)
          .attr("transform", "rotate(45)")
          .transition()
          .duration(1000)
          .attr("transform", "rotate(0)");
      }

      function resetTransform() {
        d3.select("#transform-demo .arrowed-rect polygon")
          .transition()
          .duration(500)
          .attr("transform", "none");
      }

      function changeCursor() {
        const cursor = document.getElementById("cursorStyle").value;
        d3.select("#style-demo .arrowed-rect polygon").style("cursor", cursor);
      }

      function changeFilter() {
        const filter = document.getElementById("filterEffect").value;
        d3.select("#style-demo .arrowed-rect polygon").style("filter", filter);
      }

      function addClickEvent() {
        d3.select("#event-demo .arrowed-rect polygon").on(
          "click",
          function (event) {
            const currentFill = d3.select(this).attr("fill");
            const newColor = d3.rgb(currentFill).brighter();
            d3.select(this).attr("fill", newColor);
            alert("箭头被点击了！颜色已变亮");
          }
        );
      }

      function addHoverEvent() {
        d3.select("#event-demo .arrowed-rect polygon")
          .on("mouseover", function (event) {
            d3.select(this).transition().duration(200).attr("stroke-width", 3);
          })
          .on("mouseout", function (event) {
            d3.select(this).transition().duration(200).attr("stroke-width", 1);
          });
      }

      function removeEvents() {
        d3.select("#event-demo .arrowed-rect polygon")
          .on("click", null)
          .on("mouseover", null)
          .on("mouseout", null);
      }

      function batchChangeColor() {
        d3.selectAll("#batch-demo .arrowed-rect polygon").attr(
          "fill",
          function (d, i) {
            return d3.schemeCategory10[i % 10];
          }
        );
      }

      function batchAnimate() {
        d3.selectAll("#batch-demo .arrowed-rect polygon")
          .transition()
          .duration(1000)
          .delay(function (d, i) {
            return i * 200;
          })
          .attr("transform", "scale(1.3)")
          .transition()
          .duration(1000)
          .attr("transform", "scale(1)");
      }

      function batchFilter() {
        d3.selectAll("#batch-demo .arrowed-rect polygon").style(
          "filter",
          "drop-shadow(3px 3px 3px rgba(0,0,0,0.3))"
        );
      }

      // 初始化一些事件
      addHoverEvent();
    </script>
  </body>
</html>
